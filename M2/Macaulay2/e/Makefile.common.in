# -*- Makefile -*-

# these are from include/config.Makefile
CPPFLAGS := $(M2_CPPFLAGS) $(CPPFLAGS)
CFLAGS   := $(M2_CFLAGS)   $(CFLAGS)
CXXFLAGS := $(M2_CXXFLAGS) $(CXXFLAGS) -Wno-unused-local-typedefs

ifeq "$(SHARED)" "yes"
CXXFLAGS += -fPIC
endif

ifeq (@AUTOINST@,yes)
COMPILE.cc += -frepo -fno-rtti
endif

ifeq (@IMPLINST@,no)
COMPILE.cc += -fno-implicit-templates
endif

COMPILE.cpp = $(COMPILE.cc)

%.o : %.cpp
	$(SHOW) "CXX $*.cpp"
	$(HIDE) $(COMPILE.cpp) $< $(OUTPUT_OPTION)

%.s : %.cpp
	$(SHOW) " ** compiling $< to assembly code, making $@"
	$(HIDE) $(COMPILE.cpp) -S $< $(OUTPUT_OPTION)

%.E : %.cpp
	$(SHOW) " ** preprocessing $<, making $@"
	$(HIDE) $(COMPILE.cpp) -E $< $(OUTPUT_OPTION)

%.o : %.cc
	$(SHOW) " ** compiling $<"
	$(HIDE) $(COMPILE.cc) $< $(OUTPUT_OPTION)

%.s : %.cc
	$(SHOW) " ** compiling $< to assembly code, making $@"
	$(HIDE) $(COMPILE.cc) -S $< $(OUTPUT_OPTION)

%.E : %.cc
	$(SHOW) " ** preprocessing $<, making $@"
	$(HIDE) $(COMPILE.cc) -E $< $(OUTPUT_OPTION)

ntl_interface.o: ntl_interface.cpp
	$(SHOW) " ** compiling $<"
	$(HIDE) $(COMPILE.cc) $< $(OUTPUT_OPTION) -Wno-old-style-cast

%.o : %.c
	$(SHOW) " ** compiling $<"
	$(HIDE) $(COMPILE.c) $< $(OUTPUT_OPTION)

% : %.o
	$(SHOW) " ** linking $^ to get $@"
	$(HIDE) $(LINK.cc) $^ $(LOADLIBES) $(LDLIBS) $(OUTPUT_OPTION)

%.dep: %.cpp
	$(SHOW) " ** creating $@ from $<"
	$(HIDE) @CXX@ -MM -MP $(CPPFLAGS) $(CXXFLAGS) -DDEPENDS=1 $< >$*-tmp.dep && <$*-tmp.dep sed 's/\($*\)\.o[ :]*/\1.o $@ : /' >$@ && rm $*-tmp.dep

%.dep: %.c
	$(SHOW) " ** creating $@ from $<"
	$(HIDE) @CC@  -MM -MP $(CPPFLAGS) -DDEPENDS=1 $< >$*-tmp.dep && <$*-tmp.dep sed 's/\($*\)\.o[ :]*/\1.o $@ : /' >$@ && rm $*-tmp.dep

# Local Variables:
# compile-command: "make -C $M2BUILDDIR/Macaulay2/e DEPENDS=no initialize && make -C $M2BUILDDIR/Macaulay2/e Makefile.common "
# End:
